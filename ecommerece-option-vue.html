<html>
    <head>
        <title>Vue Class work</title>
        <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
        <script src='https://cdn.tailwindcss.com'></script>
        <script src='vue.js'></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pink': {
                            DEFAULT: '#D6336C',
                            50: '#FDE5EE',
                            100: '#FBCBD6',
                            200: '#F78AAA',
                            300: '#F2497F',
                            400: '#EC1853',
                            500: '#D6336C',
                            600: '#AC2754',
                            700: '#811A3C',
                            800: '#570E24',
                            900: '#2D020C',
                            950: '#1A0005'
                        },
                        'white': {
                            DEFAULT: '#E8E8E8',
                            50: '#FFFFFF',
                            100: '#FCFCFC',
                            200: '#F7F7F7',
                            300: '#F2F2F2',
                            400: '#EDEDED',
                            500: '#E8E8E8',
                            600: '#CCCCCC',
                            700: '#B0B0B0',
                            800: '#949494',
                            900: '#787878',
                            950: '#6A6A6A'
                        },
                        'black': {
                            DEFAULT: '#0F0F0F',
                            50: '#6B6B6B',
                            100: '#616161',
                            200: '#4D4D4D',
                            300: '#383838',
                            400: '#242424',
                            500: '#0F0F0F',
                            600: '#0A0A0A',
                            700: '#050505',
                            800: '#000000',
                            900: '#000000',
                            950: '#000000'
                        },
                     },         
                   }, 
                 },
               };
      </script>
     </head>

    <body id='app' class='bg-white text-black'>    
        <div class='bg-pink-500 p-6 text-center'>
          <h1 class='text-3xl font-bold'>{{ message }}</h1>
          <button @click='changesMsg'>change Me</button>
        </div>
        <div id='container' class='flex grow flex-column'>
          <div class='bg-pink-200 p-4 w-1/4'>
            <h1 class='text-xl font-semibold'>Sidebar</h1>
          </div>
          <div id='mainBox' class='flex w-full gap-4'>
            <div
            class='bg-white-500 text-black-500 p-4 rounded-md shadow-2xl slideDown'
            style='width: 30%'
            >
               <form
                 id='ecommerceForm'
                  onsubmit='event.preventDefault();'
                   class='flex flex-col gap-4 bg-gray-100 p-6 rounded-lg shadow-lg  w-full'
                   >
                  <label>Checkout Form ( {{computedTotalCart}} )</label>
                  <input
                   type='text'
                    name='first_name'
                    v-model='checkoutForm.first_name'
                     required
                      id='first_name'
                       placeholder='Enter your first name' class='border border-gray-300 rounded-lg p-2'
                       />
                  <span class='text-red-500 hidden' id='taskErrorField-first_name'
                  >This field is required</span
                  >
                  <input
                   type='text'
                    name='last_name'
                    v-model='checkoutForm.last_name'
                     required
                      id='last_name'
                       placeholder='Enter your last name' class='border border-gray-300 rounded-lg p-2'
                       />
                  <span class='text-red-500 hidden' id='taskErrorField-last_name'
                  >This field is required</span
                  >
                  <input
                   type='tel'
                    name='number'
                    v-model='checkoutForm.phone_number'
                     required
                      id='number'
                       placeholder='Enter your phone number' class='border border-gray-300 rounded-lg p-2'
                       />
                  <span class='text-red-500 hidden' id='taskErrorField-number'
                  >This field is required</span
                  >
                  <textarea
                   id='address'
                   v-model='checkForm.address'
                    name='address'
                     placeholder='Enter your full address'class='border border-gray-300 rounded-lg p-2'
                     ></textarea>
                  <span class='text-red-500 hidden' id='taskErrorField-address'
                  >This field is required</span
                  >
                  <input
                   type='email'
                   v-model='checkoutForm.email'
                    name='email'
                     required
                      id='email'
                       placeholder='Enter your email' class='border border-gray-300 rounded-lg p-2'
                       />
                  <span class='text-red-500 hidden' id='taskErrorField-email'
                  >This field is required</span
                  >
                  <input
                   type='text'
                    name='postal_code'
                    v-model='checkoutForm.postal_code'
                     required
                      id='postal_code'
                       placeholder='Enter your postal code' class='border border-gray-300 rounded-lg p-2'
                       />
                  <span class='text-red-500 hidden' id='taskErrorField-postal_code'
                  >This field is required</span
                  >
                  <select id='city' name='city' class='border border-gray-300 rounded-lg p-2'>
                    <option selected>Karachi</option>
                    <option>Lahore</option>
                    <option>Islamabad</option>
                    <option>Peshawar</option>
                    <option>Quetta</option>
                  </select>
                  <span class='text-red-500 hidden' id='taskErrorField-city'
                  >This field is required</span
                  >
                  <select id='country' name='country' class='border border-gray-300 rounded-lg p-2'>
                    <option selected>Pakistan</option>
                  </select>
                  <span class='text-red-500 hidden' id='taskErrorField-country'
                  >This field is required</span
                  >
                  <div>
                      <label class='flex items-center'>
                          <input
                          v-model='checkoutForm.payment_method'
                          type='radio'
                          name='task'
                          required
                          id='payment_method'
                          checked
                          placeholder='Enter your payment_method'
                        />
                        Cash on Delivery
                      </label>
                      <label class='paymentLabel flex items-center'>
                        <input
                         type='radio'
                         v-model='checkoutForm.payment_method'
                         name='task' 
                         required
                         id='payment_method'
                         placeholder='Enter your payment_method'
                       />
                      Online Payment
                    </label>
                  </div>
                  <button
                   type='button'
                  @click='sumbitCheckout()'
                  id='submitBtn'
                  class='bg-pink-500 text-white p-2 rounded-lg hover:bg-pink-600 transition-all'
                   >
                  Checkout
                  </button>
                </form>
                <div>
                  <label class='text-lg font-semibold'>Cart Details</label>
                  <div 
                  id='boxList' 
                  style='
                  width: 80%;
                  display: flex; 
                  flex-direction: column;
                  gap: 4px;
                  '
                  class='grid-item slideDown'
                  >
                  </div>
                  </div>
                </div>
                <div class="box bg-red-50 font-medium text-pink-900">
                 <div
                  style='
                    padding-left: 10px;
                    border-radius: 50%;
                    padding-right: 10px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                  '
                  v-for='(x, index) in this.checkoutForm.cart_details'
                >
                  <p>{{ x.name}}</p>
                  <div
                    class='text-pink-500'
                    v-if='x.discounted_price  x.price'
                  >
                    <span class='text-red-600 line-through' :data-id='x.id'>
                      {{x.price}}
                    </span>
                    {{x.discounted_price}}
                  </div>
                  <div class='text-red-500' v-else>{{x.price}}</div>
                  <div>{{'Quantity '+ x.quantity }}</div>
                  <div>
                    <button class='text-red-500' @click='removeItemCart(x.id)'>
                      X
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>  
        <div id='main' class='p-4 grid grow border-box grid-cols-2 gap-4'>
          <div
            class='bg-white-500 text-black-500 p-4 rounded-md shadow-2xl slideDown'
            v-for='(x, index) in products'
          >
            <h1 class='font-bold'>{{ x.name }}</h1>
            <p class='font-medium'>{{ x.description }}</p>
 
            <div class='text-pink-500' v-if='x.discounted_price < x.price'>
              <span class='text-red-600 line-through'>{{ x.price }}</span>
              {{ x.discounted_price }}
            </div>
            <div class='text-pink-500' v-else>{{ x.price }}</div>
            <div class=''>
              <input type='number' :id='"qty"+ x.id' />
              <button
                class='bg-pink-400 text-white-200 font-medium rounded-lg w-32 py-1'
                @click='addToCart(x.id)'
              >
                Add to Cart
                  </button>
                </div> 
              </div>
            </div>
          </div>
        </div>
      </body>
    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            initialCheckoutForm: {
        first_name: '',
        last_name: '',
        phone_number: 0,
        address: '',
        email: '',
        postal_code: '',
        city: '',
        country: '',
        payment_method: '',
        shipping_details: {
          address: '',
          city: '',
          postal_code: '',
          country: '',
          phone_number: '',
          receiver_name: '',
        },
        total_amount: '',
        cart_details: [],
      },
      checkoutForm: {
        first_name: '',
        last_name: '',
        phone_number: 0,
        address: '',
        email: '',
        postal_code: '',
        city: '',
        country: '',
        payment_method: '',
        shipping_details: {
        address: '',
        city: '',
        postal_code: '',
        country: '',
        phone_number: '',
        reciever_name: '',
      },
      total_amount: '',
      cart_details: [],
    },
   products: [
        {
          id: 1,
          name: 'Water Bottle',
          description: 'Color: Blue, Size: Large',
          price: 100,
          discounted_price: 99,
        },
        {
          id: 2,
          name: 'Mouse',
          description: 'Wired USB Port',
          price: 250,
          discounted_price: 199,
        },
        {
          id: 3,
          name: 'Watch',
          description: 'Color: Black, Watch Type: Smart, Brand: Apple',
          price: 5000,
          discounted_price: 4999,
        },
        {
          id: 4,
          name: 'Infinix S23',
          description: 'Color: Blue, Storage: 120GB, RAM: 2GB, Display: 6x4',
          price: 25000,
          discounted_price: 24999,
        },
        {
          id: 5,
          name: 'Shoes',
          description: 'Size: 8, Color: Blue, Type: Sports Wear',
          price: 3000,
          discounted_price: 3000,
        },
       ],
       message: 'Hello Vue!',
      };
    },
    computed: {

      computedTotalCart() {
        const sum = this.checkoutForm.cart_details.reduce((accumulator, currentValue) => {
         var currentPrice = currentValue.discounted_price < currentvalue.price ? currentValue.discounted_price : currentValue.price
          return accumulator + currentPrice * currentValue.quantity
        }, 0);
        return sum;  
        }
      },
       // beforeCreate() {
       // debugger;
         // alert('we here before html appears');
       // },
       // created() {
       //   alert('we here when html created or in a process of rendering');
      // },
       // beforeMount() {
        //  let docCountry = document.getElementById('country');
        //  console.log('************** before mount **************');
        //  console.log(docCountry);
        //},
        mounted() {
          let docCountry = document.getElementById('country');
          console.log(docCountry);
          // this.renderProducts();
        },
       // beforeUpdate() {
        //  alert('i am here because message being updated');
        // },
       // updated() {
       //   alert('i am here because message is updated now');
       //   console.log('************* let see message is updated now**********');
       //   console.log(this.message);
       //   this.message = 'we are in infinite loop';
       // },
        methods: {
        validateFields() {
        var basicFields = [
          'first_name',
           'last_name',
            'address',
             'postal_code',
            ];
            const basicValidation = () => {
            var checkValidation = true;
            basicFields.forEach((x) => {
             if (
            this.checkoutForm[x] == '' ||
            this.checkoutForm[x] == null 
             ) {
            checkValidation = false;
            document.getElementById('taskErrorField-' + x).hidden = false;
          } else {
            document.getElementById('taskErrorField-' + x).hidden = true;
          }
        });
        return checkValidation;
      };
      var testBasicValidation = basicValidation();
      if (!testBasicValidation) {
        return false;
      }
        const validatePhoneNumber = (phoneNumber) => {
        const regex = /^(\+92|92|033|03)[ -]*\d{3}[ -]*\d{7}$/;
         return regex.test(phoneNumber);
        };
        if (!validatePhoneNumber(this.checkoutForm.phone_number)) {
          document.getElementById('taskErrorField-number').hidden = false;
          return false;
        } else {
          document.getElementById('taskErrorField-number').hidden = true;
        }
        const validateEmail = (email) => {
        const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        return regex.test(email);
        };
        if (!validateEmail(this.checkoutForm.email)) {
          document.getElementById('taskErrorField-email').hidden = false;
          return false;
        } else {
          document.getElementById('taskErrorField-email').hidden = true;
        } 
        if (checkoutForm.cart_details.length == 0) {
          alert('Please add items to your cart first');
          return false;
        }
        return true;
      },
 
       sumbitCheckout() {
        debugger;
        const checkForm = this.validateFields();
        if (checkForm) {
          alert('Thank you for shopping with us');
          checkoutForm = { ...initialCheckoutForm };
          checkoutForm.cart_details = [];
          document.getElementById('ecommerceForm').reset();
        }
      },
       addToCart(product) {
        var currentProduct = this.products.find((x) => {
          return x.id == product;
        });
        // ternary operator
        // var ternaryOpt = 5 > 10 || 5 < 10 ? 5 : 10;
        const currentQty = 
        document.getElementById('qty' + product).value == '' ||
        document.getElementById('qty' + product).value == null
        ? 1
        : document.getElementById('qty' + product).value; 
        cartExistIndex = this.checkoutForm.cart_details.findIndex((x) => {
          return x.id == product;
        });
        if (cartExistIndex != -1) {
          this.checkoutForm.cart_details[cartExistIndex].quantity +=
           parseInt(currentQty);
        } else {
          var cartItem = { 
            ...currentProduct,
             quantity: currentQty,
             };
          this.checkoutForm.cart_details.push(cartItem);
        }
        document.getElementById('qty' + product).value = '';
        },
        
       removeItemCart(id) {
        var proIndex = this.checkoutForm.cart_details.findIndex((x) => {
          return x.id == id;
        });
        this.checkoutForm.cart_details.splice(proIndex, 1);
      },

      changesMsg() {
        this.message = 'I am change now';
      },
   },
  }).mount('#app');
  </script>
</html>
    
 
       